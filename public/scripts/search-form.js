import { renderBlock } from './lib.js';
import { dataDb } from './index.js';
import { renderSearchResultsBlock, toggleFavoriteItem } from './search-results.js';
import { FlatRentSdk } from './flat-rent-sdk.js';
function handlerSearch(data, price) {
    let allFind = {};
    let find = null;
    let key = null;
    (function searchAll(data, price) {
        for (let i in data) {
            if (data.hasOwnProperty(i)) {
                if (i === 'price') {
                    if (price >= data[i]) {
                        find = data;
                        key = data.id;
                        allFind[key] = find;
                    }
                }
                if (data[i] && data[i].constructor === Object) {
                    searchAll(data[i], price);
                }
            }
        }
        return allFind;
    })(data, price);
    return allFind;
}
export function search() {
    const form = document.getElementsByTagName('form')[0];
    form.onsubmit = (e) => {
        e.preventDefault();
        let formData = new FormData(form);
        // let inDate = formData.get('checkin').toString();
        // console.log(new Date(inDate));
        //получить чекбоксы
        const checkboxes = document.getElementsByClassName('selectProvider');
        const checkedItem = [];
        //выбранные сложить в массив
        for (let i = 0; i < checkboxes.length; i++) {
            let item = checkboxes[i];
            if (item.checked) {
                checkedItem.push(item);
            }
        }
        const data = {
            city: 'Санкт-Петербург',
            inDate: formData.get('checkin').toString(),
            outDate: formData.get('checkout').toString(),
            maxPrice: +formData.get('price')
        };
        // при отправке формы проверяем выбран ли провыйдер
        if (!checkedItem.length) { // если нет, то выбрать
            console.log('Choose provider and submit again.');
        }
        //из выбранных посмотреть один или оба выбраны и в зависимости от этого на поиск разные функции
        for (let i = 0; i < checkedItem.length; i++) {
            if (checkedItem[i].value === 'homy') {
                renderSearchResultsBlock(handlerSearch(dataDb, data.maxPrice));
                toggleFavoriteItem();
            }
            else if (checkedItem[i].value === 'flat-rent') {
                console.log('будем искать в sdk');
                const newFlat = new FlatRentSdk;
                const flatRentData = {
                    city: 'Санкт-Петербург',
                    checkInDate: new Date(formData.get('checkin').toString()),
                    checkOutDate: new Date(formData.get('checkout').toString()),
                    priceLimit: +formData.get('price')
                };
                const foundFlats = newFlat.search(flatRentData);
                // поиск по отдельности работает, решить с разным именованием полей
                // сделать поиск у двух провайдеров одновременно
                console.log(foundFlats.then(res => {
                    renderSearchResultsBlock(res);
                    toggleFavoriteItem();
                }));
            }
        }
    };
}
const d = new Date();
const dateOut = new Date(d.getFullYear(), d.getMonth() + 2, 0);
const defaultDateIn = new Date(d.setDate(d.getDate() + 1));
const defaultDateOut = new Date(d.setDate(d.getDate() + 3));
function formattedDate(date) {
    return [date.getFullYear(), date.getMonth() + 1, date.getDate()].map(n => n < 10 ? `0${n}` : `${n}`).join('-');
}
const today = formattedDate(d);
const maxOutDate = formattedDate(dateOut);
const defaultIn = formattedDate(defaultDateIn);
const defaultOut = formattedDate(defaultDateOut);
export function renderSearchFormBlock(dateIn = defaultIn, dateOut = defaultOut) {
    renderBlock('search-form-block', `
    <form id="form">
      <fieldset class="search-filedset">
        <div class="row">
          <div>
            <label for="city">Город</label>
            <input id="city" type="text" disabled value="Санкт-Петербург" />
            <input type="hidden" disabled value="59.9386,30.3141" />
          </div>
          <div class="providers">
            <label><input type="checkbox" name="provider" class="selectProvider" value="homy" checked /> Homy</label>
            <label><input type="checkbox" name="provider" class="selectProvider" value="flat-rent" /> FlatRent</label>
          </div>
        </div>
        <div class="row">
          <div>
            <label for="check-in-date">Дата заезда</label>
            <input id="check-in-date" type="date" value="${dateIn}" min="${today}" max="${maxOutDate}" name="checkin" />
          </div>
          <div>
            <label for="check-out-date">Дата выезда</label>
            <input id="check-out-date" type="date" value="${dateOut}" min="${today}" max="${maxOutDate}" name="checkout" />
          </div>
          <div>
            <label for="max-price">Макс. цена суток</label>
            <input id="max-price" type="text" value="" name="price" class="max-price" />
          </div>
          <div>
            <div><button type="submit">Найти</button></div>
          </div>
        </div>
      </fieldset>
    </form>
    `);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VhcmNoLWZvcm0uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvc2VhcmNoLWZvcm0udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLFVBQVUsQ0FBQTtBQUN0QyxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sWUFBWSxDQUFBO0FBQ25DLE9BQU8sRUFBRSx3QkFBd0IsRUFBRSxrQkFBa0IsRUFBRSxNQUFNLHFCQUFxQixDQUFBO0FBQ2xGLE9BQU8sRUFBQyxXQUFXLEVBQUMsTUFBTSxvQkFBb0IsQ0FBQTtBQXVCOUMsU0FBUyxhQUFhLENBQUMsSUFBSSxFQUFFLEtBQUs7SUFDaEMsSUFBSSxPQUFPLEdBQUcsRUFBRSxDQUFDO0lBQ2pCLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQztJQUNoQixJQUFJLEdBQUcsR0FBRyxJQUFJLENBQUM7SUFFZixDQUFDLFNBQVMsU0FBUyxDQUFFLElBQUksRUFBRSxLQUFLO1FBQzlCLEtBQUssSUFBSSxDQUFDLElBQUksSUFBSSxFQUFFO1lBQ2hCLElBQUksSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsRUFBRTtnQkFDMUIsSUFBSSxDQUFDLEtBQUssT0FBTyxFQUFFO29CQUNqQixJQUFLLEtBQUssSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUU7d0JBQ3JCLElBQUksR0FBRyxJQUFJLENBQUM7d0JBQ1osR0FBRyxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUM7d0JBQ2QsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQztxQkFDckI7aUJBQ0Y7Z0JBQ0QsSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLFdBQVcsS0FBSyxNQUFNLEVBQUU7b0JBQzdDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUE7aUJBQzFCO2FBQ0Y7U0FDRjtR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QyxDQUFDO0FBQy9DLE1BQU0sVUFBVSxHQUFHLGFBQWEsQ0FBQyxjQUFjLENBQUMsQ0FBQztBQUVqRCxNQUFNLFVBQVUscUJBQXFCLENBQUUsU0FBaUIsU0FBUyxFQUFFLFVBQWtCLFVBQVU7SUFDN0YsV0FBVyxDQUNULG1CQUFtQixFQUNuQjs7Ozs7Ozs7Ozs7Ozs7Ozs7MkRBaUJ1RCxNQUFNLFVBQVUsS0FBSyxVQUFVLFVBQVU7Ozs7NERBSXhDLE9BQU8sVUFBVSxLQUFLLFVBQVUsVUFBVTs7Ozs7Ozs7Ozs7O0tBWWpHLENBQ0YsQ0FBQTtBQUNILENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyByZW5kZXJCbG9jayB9IGZyb20gJy4vbGliLmpzJ1xuaW1wb3J0IHsgZGF0YURiIH0gZnJvbSAnLi9pbmRleC5qcydcbmltcG9ydCB7IHJlbmRlclNlYXJjaFJlc3VsdHNCbG9jaywgdG9nZ2xlRmF2b3JpdGVJdGVtIH0gZnJvbSAnLi9zZWFyY2gtcmVzdWx0cy5qcydcbmltcG9ydCB7RmxhdFJlbnRTZGt9IGZyb20gJy4vZmxhdC1yZW50LXNkay5qcydcblxuaW50ZXJmYWNlIFBsYWNlIHtcbiAgXCJpZFwiOiBudW1iZXIsXG4gIFwibmFtZVwiOiBzdHJpbmcsXG4gIFwiZGVzY3JpcHRpb25cIjogc3RyaW5nLFxuICBcImltYWdlXCI6IHN0cmluZyxcbiAgXCJyZW1vdGVuZXNzXCI6IG51bWJlcixcbiAgXCJib29rZWREYXRlc1wiOiBzdHJpbmdbXSxcbiAgXCJwcmljZVwiOiBudW1iZXJcbn1cblxuaW50ZXJmYWNlIFBsYWNlcyB7XG4gIFtrZXk6IG51bWJlcl06IFBsYWNlXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2VhcmNoRm9ybURhdGEge1xuICBjaXR5OiBzdHJpbmcsXG4gIGluRGF0ZTogc3RyaW5nLFxuICBvdXREYXRlOiBzdHJpbmcsXG4gIG1heFByaWNlOiBudW1iZXIsXG59XG5cbmZ1bmN0aW9uIGhhbmRsZXJTZWFyY2goZGF0YSwgcHJpY2UpOiBQbGFjZXMge1xuICBsZXQgYWxsRmluZCA9IHt9O1xuICBsZXQgZmluZCA9IG51bGw7XG4gIGxldCBrZXkgPSBudWxsO1xuXG4gIChmdW5jdGlvbiBzZWFyY2hBbGwgKGRhdGEsIHByaWNlKSB7XG4gICAgZm9yIChsZXQgaSBpbiBkYXRhKSB7XG4gICAgICAgIGlmIChkYXRhLmhhc093blByb3BlcnR5KGkpKSB7XG4gICAgICAgICAgaWYgKGkgPT09ICdwcmljZScpIHtcbiAgICAgICAgICAgIGlmICggcHJpY2UgPj0gZGF0YVtpXSkge1xuICAgICAgICAgICAgICBmaW5kID0gZGF0YTtcbiAgICAgICAgICAgICAga2V5ID0gZGF0YS5pZDtcbiAgICAgICAgICAgICAgYWxsRmluZFtrZXldID0gZmluZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKGRhdGFbaV0gJiYgZGF0YVtpXS5jb25zdHJ1Y3RvciA9PT0gT2JqZWN0KSB7XG4gICAgICAgICAgICBzZWFyY2hBbGwoZGF0YVtpXSwgcHJpY2UpXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgcmV0dXJuIGFsbEZpbmQ7ICBcbiAgfSkoZGF0YSwgcHJpY2UpXG5cbiAgcmV0dXJuIGFsbEZpbmQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzZWFyY2goKSB7XG4gIGNvbnN0IGZvcm0gPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnZm9ybScpWzBdO1xuICBcbiAgZm9ybS5vbnN1Ym1pdCA9IChlKSA9PiB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGxldCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YShmb3JtKTtcbiAgICAvLyBsZXQgaW5EYXRlID0gZm9ybURhdGEuZ2V0KCdjaGVja2luJykudG9TdHJpbmcoKTtcbiAgICAvLyBjb25zb2xlLmxvZyhuZXcgRGF0ZShpbkRhdGUpKTtcbiAgICBcbiAgICAvL9C/0L7Qu9GD0YfQuNGC0Ywg0YfQtdC60LHQvtC60YHRi1xuICAgIGNvbnN0IGNoZWNrYm94ZXMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdzZWxlY3RQcm92aWRlcicpO1xuICAgIGNvbnN0IGNoZWNrZWRJdGVtID0gW107XG4gICAgLy/QstGL0LHRgNCw0L3QvdGL0LUg0YHQu9C+0LbQuNGC0Ywg0LIg0LzQsNGB0YHQuNCyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjaGVja2JveGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBsZXQgaXRlbSA9IGNoZWNrYm94ZXNbaV0gYXMgSFRNTElucHV0RWxlbWVudFxuICAgICAgaWYgKGl0ZW0uY2hlY2tlZCkge1xuICAgICAgICBjaGVja2VkSXRlbS5wdXNoKGl0ZW0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IGRhdGE6IFNlYXJjaEZvcm1EYXRhID0ge1xuICAgICAgY2l0eTogJ9Ch0LDQvdC60YIt0J/QtdGC0LXRgNCx0YPRgNCzJyxcbiAgICAgIGluRGF0ZTogZm9ybURhdGEuZ2V0KCdjaGVja2luJykudG9TdHJpbmcoKSxcbiAgICAgIG91dERhdGU6IGZvcm1EYXRhLmdldCgnY2hlY2tvdXQnKS50b1N0cmluZygpLFxuICAgICAgbWF4UHJpY2U6ICtmb3JtRGF0YS5nZXQoJ3ByaWNlJylcbiAgICB9XG4gIC8vINC/0YDQuCDQvtGC0L/RgNCw0LLQutC1INGE0L7RgNC80Ysg0L/RgNC+0LLQtdGA0Y/QtdC8INCy0YvQsdGA0LDQvSDQu9C4INC/0YDQvtCy0YvQudC00LXRgFxuICBpZiAoIWNoZWNrZWRJdGVtLmxlbmd0aCkgeyAvLyDQtdGB0LvQuCDQvdC10YIsINGC0L4g0LLRi9Cx0YDQsNGC0YxcbiAgICBjb25zb2xlLmxvZygnQ2hvb3NlIHByb3ZpZGVyIGFuZCBzdWJtaXQgYWdhaW4uJyk7XG4gIH1cbiAgLy/QuNC3INCy0YvQsdGA0LDQvdC90YvRhSDQv9C+0YHQvNC+0YLRgNC10YLRjCDQvtC00LjQvSDQuNC70Lgg0L7QsdCwINCy0YvQsdGA0LDQvdGLINC4INCyINC30LDQstC40YHQuNC80L7RgdGC0Lgg0L7RgiDRjdGC0L7Qs9C+INC90LAg0L/QvtC40YHQuiDRgNCw0LfQvdGL0LUg0YTRg9C90LrRhtC40LhcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBjaGVja2VkSXRlbS5sZW5ndGg7IGkrKykge1xuICAgIGlmIChjaGVja2VkSXRlbVtpXS52YWx1ZSA9PT0gJ2hvbXknKSB7XG4gICAgICByZW5kZXJTZWFyY2hSZXN1bHRzQmxvY2soaGFuZGxlclNlYXJjaChkYXRhRGIsIGRhdGEubWF4UHJpY2UpKTtcbiAgICAgIHRvZ2dsZUZhdm9yaXRlSXRlbSgpO1xuICAgIH0gZWxzZSBpZiAoY2hlY2tlZEl0ZW1baV0udmFsdWUgPT09ICdmbGF0LXJlbnQnKSB7XG4gICAgICBjb25zb2xlLmxvZygn0LHRg9C00LXQvCDQuNGB0LrQsNGC0Ywg0LIgc2RrJyk7XG4gICAgICBjb25zdCBuZXdGbGF0ID0gbmV3IEZsYXRSZW50U2RrO1xuICAgICAgY29uc3QgZmxhdFJlbnREYXRhID0ge1xuICAgICAgICBjaXR5OiAn0KHQsNC90LrRgi3Qn9C10YLQtdGA0LHRg9GA0LMnLFxuICAgICAgICBjaGVja0luRGF0ZTogbmV3IERhdGUoZm9ybURhdGEuZ2V0KCdjaGVja2luJykudG9TdHJpbmcoKSksXG4gICAgICAgIGNoZWNrT3V0RGF0ZTogbmV3IERhdGUoZm9ybURhdGEuZ2V0KCdjaGVja291dCcpLnRvU3RyaW5nKCkpLFxuICAgICAgICBwcmljZUxpbWl0OiArZm9ybURhdGEuZ2V0KCdwcmljZScpXG4gICAgICB9XG4gICAgICBjb25zdCBmb3VuZEZsYXRzID0gbmV3RmxhdC5zZWFyY2goZmxhdFJlbnREYXRhKSBcbiAgICAgIC8vINC/0L7QuNGB0Log0L/QviDQvtGC0LTQtdC70YzQvdC+0YHRgtC4INGA0LDQsdC+0YLQsNC10YIsINGA0LXRiNC40YLRjCDRgSDRgNCw0LfQvdGL0Lwg0LjQvNC10L3QvtCy0LDQvdC40LXQvCDQv9C+0LvQtdC5XG4gICAgICAvLyDRgdC00LXQu9Cw0YLRjCDQv9C+0LjRgdC6INGDINC00LLRg9GFINC/0YDQvtCy0LDQudC00LXRgNC+0LIg0L7QtNC90L7QstGA0LXQvNC10L3QvdC+XG4gICAgICBjb25zb2xlLmxvZyhmb3VuZEZsYXRzLnRoZW4ocmVzID0+IHtcbiAgICAgICAgcmVuZGVyU2VhcmNoUmVzdWx0c0Jsb2NrKHJlcylcbiAgICAgICAgdG9nZ2xlRmF2b3JpdGVJdGVtKClcbiAgICAgIH0pKVxuICAgICAgXG4gICAgfVxuICAgIFxuICB9XG5cbn1cbn1cblxuY29uc3QgZCA9IG5ldyBEYXRlKCk7XG5jb25zdCBkYXRlT3V0ID0gbmV3IERhdGUoZC5nZXRGdWxsWWVhcigpLCBkLmdldE1vbnRoKCkgKyAyLCAwKTtcbmNvbnN0IGRlZmF1bHREYXRlSW4gPSBuZXcgRGF0ZShkLnNldERhdGUoZC5nZXREYXRlKCkgKyAxKSk7XG5jb25zdCBkZWZhdWx0RGF0ZU91dCA9IG5ldyBEYXRlKGQuc2V0RGF0ZShkLmdldERhdGUoKSArIDMpKTtcblxuZnVuY3Rpb24gZm9ybWF0dGVkRGF0ZShkYXRlKSB7XG4gIHJldHVybiBbZGF0ZS5nZXRGdWxsWWVhcigpLCBkYXRlLmdldE1vbnRoKCkgKyAxLCBkYXRlLmdldERhdGUoKV0ubWFwKG4gPT4gbiA8IDEwID8gYDAke259YCA6IGAke259YCkuam9pbignLScpO1xufVxuXG5jb25zdCB0b2RheSA9IGZvcm1hdHRlZERhdGUoZCk7XG5jb25zdCBtYXhPdXREYXRlID0gZm9ybWF0dGVkRGF0ZShkYXRlT3V0KTtcbmNvbnN0IGRlZmF1bHRJbiA9IGZvcm1hdHRlZERhdGUoZGVmYXVsdERhdGVJbik7XG5jb25zdCBkZWZhdWx0T3V0ID0gZm9ybWF0dGVkRGF0ZShkZWZhdWx0RGF0ZU91dCk7XG5cbmV4cG9ydCBmdW5jdGlvbiByZW5kZXJTZWFyY2hGb3JtQmxvY2sgKGRhdGVJbjogc3RyaW5nID0gZGVmYXVsdEluLCBkYXRlT3V0OiBzdHJpbmcgPSBkZWZhdWx0T3V0KSB7XG4gIHJlbmRlckJsb2NrKFxuICAgICdzZWFyY2gtZm9ybS1ibG9jaycsXG4gICAgYFxuICAgIDxmb3JtIGlkPVwiZm9ybVwiPlxuICAgICAgPGZpZWxkc2V0IGNsYXNzPVwic2VhcmNoLWZpbGVkc2V0XCI+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJyb3dcIj5cbiAgICAgICAgICA8ZGl2PlxuICAgICAgICAgICAgPGxhYmVsIGZvcj1cImNpdHlcIj7Qk9C+0YDQvtC0PC9sYWJlbD5cbiAgICAgICAgICAgIDxpbnB1dCBpZD1cImNpdHlcIiB0eXBlPVwidGV4dFwiIGRpc2FibGVkIHZhbHVlPVwi0KHQsNC90LrRgi3Qn9C10YLQtdGA0LHRg9GA0LNcIiAvPlxuICAgICAgICAgICAgPGlucHV0IHR5cGU9XCJoaWRkZW5cIiBkaXNhYmxlZCB2YWx1ZT1cIjU5LjkzODYsMzAuMzE0MVwiIC8+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgPGRpdiBjbGFzcz1cInByb3ZpZGVyc1wiPlxuICAgICAgICAgICAgPGxhYmVsPjxpbnB1dCB0eXBlPVwiY2hlY2tib3hcIiBuYW1lPVwicHJvdmlkZXJcIiBjbGFzcz1cInNlbGVjdFByb3ZpZGVyXCIgdmFsdWU9XCJob215XCIgY2hlY2tlZCAvPiBIb215PC9sYWJlbD5cbiAgICAgICAgICAgIDxsYWJlbD48aW5wdXQgdHlwZT1cImNoZWNrYm94XCIgbmFtZT1cInByb3ZpZGVyXCIgY2xhc3M9XCJzZWxlY3RQcm92aWRlclwiIHZhbHVlPVwiZmxhdC1yZW50XCIgLz4gRmxhdFJlbnQ8L2xhYmVsPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cInJvd1wiPlxuICAgICAgICAgIDxkaXY+XG4gICAgICAgICAgICA8bGFiZWwgZm9yPVwiY2hlY2staW4tZGF0ZVwiPtCU0LDRgtCwINC30LDQtdC30LTQsDwvbGFiZWw+XG4gICAgICAgICAgICA8aW5wdXQgaWQ9XCJjaGVjay1pbi1kYXRlXCIgdHlwZT1cImRhdGVcIiB2YWx1ZT1cIiR7ZGF0ZUlufVwiIG1pbj1cIiR7dG9kYXl9XCIgbWF4PVwiJHttYXhPdXREYXRlfVwiIG5hbWU9XCJjaGVja2luXCIgLz5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8ZGl2PlxuICAgICAgICAgICAgPGxhYmVsIGZvcj1cImNoZWNrLW91dC1kYXRlXCI+0JTQsNGC0LAg0LLRi9C10LfQtNCwPC9sYWJlbD5cbiAgICAgICAgICAgIDxpbnB1dCBpZD1cImNoZWNrLW91dC1kYXRlXCIgdHlwZT1cImRhdGVcIiB2YWx1ZT1cIiR7ZGF0ZU91dH1cIiBtaW49XCIke3RvZGF5fVwiIG1heD1cIiR7bWF4T3V0RGF0ZX1cIiBuYW1lPVwiY2hlY2tvdXRcIiAvPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDxkaXY+XG4gICAgICAgICAgICA8bGFiZWwgZm9yPVwibWF4LXByaWNlXCI+0JzQsNC60YEuINGG0LXQvdCwINGB0YPRgtC+0Lo8L2xhYmVsPlxuICAgICAgICAgICAgPGlucHV0IGlkPVwibWF4LXByaWNlXCIgdHlwZT1cInRleHRcIiB2YWx1ZT1cIlwiIG5hbWU9XCJwcmljZVwiIGNsYXNzPVwibWF4LXByaWNlXCIgLz5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8ZGl2PlxuICAgICAgICAgICAgPGRpdj48YnV0dG9uIHR5cGU9XCJzdWJtaXRcIj7QndCw0LnRgtC4PC9idXR0b24+PC9kaXY+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9maWVsZHNldD5cbiAgICA8L2Zvcm0+XG4gICAgYFxuICApXG59XG4iXX0=