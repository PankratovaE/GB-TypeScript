import { renderBlock } from './lib.js';
import { dataDb } from './index.js';
import { renderSearchResultsBlock, toggleFavoriteItem } from './search-results.js';
import { FlatRentSdk } from './flat-rent-sdk.js';
function handlerSearch(data, price) {
    let allFind = {};
    let find = null;
    let key = null;
    (function searchAll(data, price) {
        for (let i in data) {
            if (data.hasOwnProperty(i)) {
                if (i === 'totalPrice') {
                    if (price >= data[i]) {
                        find = data;
                        key = data.id;
                        allFind[key] = find;
                    }
                }
                if (data[i] && data[i].constructor === Object) {
                    searchAll(data[i], price);
                }
            }
        }
        return allFind;
    })(data, price);
    return allFind;
}
export function search() {
    const form = document.getElementsByTagName('form')[0];
    form.onsubmit = (e) => {
        e.preventDefault();
        let formData = new FormData(form);
        //получить чекбоксы
        const checkboxes = document.getElementsByClassName('selectProvider');
        const checkedItem = [];
        //выбранные сложить в массив
        for (let i = 0; i < checkboxes.length; i++) {
            let item = checkboxes[i];
            if (item.checked) {
                checkedItem.push(item);
            }
        }
        const data = {
            city: 'Санкт-Петербург',
            inDate: formData.get('checkin').toString(),
            outDate: formData.get('checkout').toString(),
            maxPrice: +formData.get('price')
        };
        // при отправке формы проверяем выбран ли провыйдер
        if (!checkedItem.length) { // если нет, то выбрать
            console.log('Choose provider and submit again.');
        }
        else {
            let homyFounded = {};
            let flatRentFounded = {};
            let allFound = {};
            for (let i = 0; i < checkedItem.length; i++) {
                if (checkedItem[i].value === 'homy') {
                    homyFounded = handlerSearch(dataDb, data.maxPrice);
                    allFound = Object.assign(homyFounded);
                    renderSearchResultsBlock(allFound);
                    toggleFavoriteItem();
                }
                if (checkedItem[i].value === 'flat-rent') {
                    const newFlat = new FlatRentSdk;
                    const flatRentData = {
                        city: 'Санкт-Петербург',
                        checkInDate: new Date(formData.get('checkin').toString()),
                        checkOutDate: new Date(formData.get('checkout').toString()),
                        priceLimit: +formData.get('price')
                    };
                    const foundFlats = newFlat.search(flatRentData);
                    foundFlats.then(res => {
                        flatRentFounded = Object.assign({}, res);
                        //переименовать ключи в получившемся объекте
                        let renamedFlatRent = Object.entries(flatRentFounded).reduce((u, [n, v]) => {
                            u[`${n}FRsdk`] = v;
                            return u;
                        }, {});
                        //собрать два объекта в один
                        allFound = Object.assign(homyFounded, renamedFlatRent);
                        //вызвать рендер с общим объектом
                        renderSearchResultsBlock(allFound);
                        toggleFavoriteItem();
                    });
                }
            }
        }
    };
}
const d = new Date();
const dateOut = new Date(d.getFullYear(), d.getMonth() + 2, 0);
const defaultDateIn = new Date(d.setDate(d.getDate() + 1));
const defaultDateOut = new Date(d.setDate(d.getDate() + 3));
function formattedDate(date) {
    return [date.getFullYear(), date.getMonth() + 1, date.getDate()].map(n => n < 10 ? `0${n}` : `${n}`).join('-');
}
const today = formattedDate(d);
const maxOutDate = formattedDate(dateOut);
const defaultIn = formattedDate(defaultDateIn);
const defaultOut = formattedDate(defaultDateOut);
export function renderSearchFormBlock(dateIn = defaultIn, dateOut = defaultOut) {
    renderBlock('search-form-block', `
    <form id="form">
      <fieldset class="search-filedset">
        <div class="row">
          <div>
            <label for="city">Город</label>
            <input id="city" type="text" disabled value="Санкт-Петербург" />
            <input type="hidden" disabled value="59.9386,30.3141" />
          </div>
          <div class="providers">
            <label><input type="checkbox" name="provider" class="selectProvider" value="homy" checked /> Homy</label>
            <label><input type="checkbox" name="provider" class="selectProvider" value="flat-rent" /> FlatRent</label>
          </div>
        </div>
        <div class="row">
          <div>
            <label for="check-in-date">Дата заезда</label>
            <input id="check-in-date" type="date" value="${dateIn}" min="${today}" max="${maxOutDate}" name="checkin" />
          </div>
          <div>
            <label for="check-out-date">Дата выезда</label>
            <input id="check-out-date" type="date" value="${dateOut}" min="${today}" max="${maxOutDate}" name="checkout" />
          </div>
          <div>
            <label for="max-price">Макс. цена суток</label>
            <input id="max-price" type="text" value="" name="price" class="max-price" />
          </div>
          <div>
            <div><button type="submit">Найти</button></div>
          </div>
        </div>
      </fieldset>
    </form>
    `);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VhcmNoLWZvcm0uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvc2VhcmNoLWZvcm0udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLFVBQVUsQ0FBQTtBQUN0QyxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sWUFBWSxDQUFBO0FBQ25DLE9BQU8sRUFBRSx3QkFBd0IsRUFBRSxrQkFBa0IsRUFBRSxNQUFNLHFCQUFxQixDQUFBO0FBQ2xGLE9BQU8sRUFBQyxXQUFXLEVBQUMsTUFBTSxvQkFBb0IsQ0FBQTtBQXVCOUMsU0FBUyxhQUFhLENBQUMsSUFBSSxFQUFFLEtBQUs7SUFDaEMsSUFBSSxPQUFPLEdBQUcsRUFBRSxDQUFDO0lBQ2pCLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQztJQUNoQixJQUFJLEdBQUcsR0FBRyxJQUFJLENBQUM7SUFFZixDQUFDLFNBQVMsU0FBUyxDQUFFLElBQUksRUFBRSxLQUFLO1FBQzlCLEtBQUssSUFBSSxDQUFDLElBQUksSUFBSSxFQUFFO1lBQ2hCLElBQUksSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsRUFBRTtnQkFDMUIsSUFBSSxDQUFDLEtBQUssWUFBWSxFQUFFO29CQUN0QixJQUFLLEtBQUssSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUU7d0JBRXJCLElBQUksR0FBRyxJQUFJLENBQUM7d0JBQ1osR0FBRyxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUM7d0JBQ2QsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQztxQkFDckI7aUJBQ0Y7Z0JBQ0QsSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLFdBQVcsS0FBSyxNQUFNLEVBQUU7b0JBQzdDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUE7aUJBQzFCO2FBQ0Y7U0FDRjtR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QUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUU1RCxTQUFTLGFBQWEsQ0FBQyxJQUFJO0lBQ3pCLE9BQU8sQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFLEVBQUUsSUFBSSxDQUFDLFFBQVEsRUFBRSxHQUFHLENBQUMsRUFBRSxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0FBQ2pILENBQUM7QUFFRCxNQUFNLEtBQUssR0FBRyxhQUFhLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDL0IsTUFBTSxVQUFVLEdBQUcsYUFBYSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0FBQzFDLE1BQU0sU0FBUyxHQUFHLGFBQWEsQ0FBQyxhQUFhLENBQUMsQ0FBQztBQUMvQyxNQUFNLFVBQVUsR0FBRyxhQUFhLENBQUMsY0FBYyxDQUFDLENBQUM7QUFFakQsTUFBTSxVQUFVLHFCQUFxQixDQUFFLFNBQWlCLFNBQVMsRUFBRSxVQUFrQixVQUFVO0lBQzdGLFdBQVcsQ0FDVCxtQkFBbUIsRUFDbkI7Ozs7Ozs7Ozs7Ozs7Ozs7OzJEQWlCdUQsTUFBTSxVQUFVLEtBQUssVUFBVSxVQUFVOzs7OzREQUl4QyxPQUFPLFVBQVUsS0FBSyxVQUFVLFVBQVU7Ozs7Ozs7Ozs7OztLQVlqRyxDQUNGLENBQUE7QUFDSCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcmVuZGVyQmxvY2sgfSBmcm9tICcuL2xpYi5qcydcbmltcG9ydCB7IGRhdGFEYiB9IGZyb20gJy4vaW5kZXguanMnXG5pbXBvcnQgeyByZW5kZXJTZWFyY2hSZXN1bHRzQmxvY2ssIHRvZ2dsZUZhdm9yaXRlSXRlbSB9IGZyb20gJy4vc2VhcmNoLXJlc3VsdHMuanMnXG5pbXBvcnQge0ZsYXRSZW50U2RrfSBmcm9tICcuL2ZsYXQtcmVudC1zZGsuanMnXG5cbmV4cG9ydCBpbnRlcmZhY2UgUGxhY2Uge1xuICBcImlkXCI6IG51bWJlcixcbiAgXCJ0aXRsZVwiOiBzdHJpbmcsIC8vbmFtZVxuICBcImRldGFpbHNcIjogc3RyaW5nLCAvL2Rlc2NyaXB0aW9uXG4gIFwicGhvdG9zXCI6IHN0cmluZyBbXSwgLy9pbWFnZVxuICBcImNvb3JkaW5hdGVzXCI6IFtdLFxuICBcImJvb2tlZERhdGVzXCI6IHN0cmluZ1tdLFxuICBcInRvdGFsUHJpY2VcIjogbnVtYmVyIC8vcHJpY2Vcbn1cblxuZXhwb3J0IGludGVyZmFjZSBQbGFjZXMge1xuICBba2V5OiBudW1iZXJdOiBQbGFjZVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFNlYXJjaEZvcm1EYXRhIHtcbiAgY2l0eTogc3RyaW5nLFxuICBpbkRhdGU6IHN0cmluZyxcbiAgb3V0RGF0ZTogc3RyaW5nLFxuICBtYXhQcmljZTogbnVtYmVyLFxufVxuXG5mdW5jdGlvbiBoYW5kbGVyU2VhcmNoKGRhdGEsIHByaWNlKTogUGxhY2VzIHtcbiAgbGV0IGFsbEZpbmQgPSB7fTtcbiAgbGV0IGZpbmQgPSBudWxsO1xuICBsZXQga2V5ID0gbnVsbDtcbiBcbiAgKGZ1bmN0aW9uIHNlYXJjaEFsbCAoZGF0YSwgcHJpY2UpIHtcbiAgICBmb3IgKGxldCBpIGluIGRhdGEpIHtcbiAgICAgICAgaWYgKGRhdGEuaGFzT3duUHJvcGVydHkoaSkpIHtcbiAgICAgICAgICBpZiAoaSA9PT0gJ3RvdGFsUHJpY2UnKSB7XG4gICAgICAgICAgICBpZiAoIHByaWNlID49IGRhdGFbaV0pIHtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgICBmaW5kID0gZGF0YTtcbiAgICAgICAgICAgICAga2V5ID0gZGF0YS5pZDtcbiAgICAgICAgICAgICAgYWxsRmluZFtrZXldID0gZmluZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKGRhdGFbaV0gJiYgZGF0YVtpXS5jb25zdHJ1Y3RvciA9PT0gT2JqZWN0KSB7XG4gICAgICAgICAgICBzZWFyY2hBbGwoZGF0YVtpXSwgcHJpY2UpXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgcmV0dXJuIGFsbEZpbmQ7ICBcbiAgfSkoZGF0YSwgcHJpY2UpXG5cbiAgcmV0dXJuIGFsbEZpbmQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzZWFyY2goKSB7XG4gIGNvbnN0IGZvcm0gPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnZm9ybScpWzBdO1xuICBcbiAgZm9ybS5vbnN1Ym1pdCA9IChlKSA9PiB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGxldCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YShmb3JtKTtcblxuICAgIC8v0L/QvtC70YPRh9C40YLRjCDRh9C10LrQsdC+0LrRgdGLXG4gICAgY29uc3QgY2hlY2tib3hlcyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3NlbGVjdFByb3ZpZGVyJyk7XG4gICAgY29uc3QgY2hlY2tlZEl0ZW0gPSBbXTtcbiAgICAvL9Cy0YvQsdGA0LDQvdC90YvQtSDRgdC70L7QttC40YLRjCDQsiDQvNCw0YHRgdC40LJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNoZWNrYm94ZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGxldCBpdGVtID0gY2hlY2tib3hlc1tpXSBhcyBIVE1MSW5wdXRFbGVtZW50XG4gICAgICBpZiAoaXRlbS5jaGVja2VkKSB7XG4gICAgICAgIGNoZWNrZWRJdGVtLnB1c2goaXRlbSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgZGF0YTogU2VhcmNoRm9ybURhdGEgPSB7XG4gICAgICBjaXR5OiAn0KHQsNC90LrRgi3Qn9C10YLQtdGA0LHRg9GA0LMnLFxuICAgICAgaW5EYXRlOiBmb3JtRGF0YS5nZXQoJ2NoZWNraW4nKS50b1N0cmluZygpLFxuICAgICAgb3V0RGF0ZTogZm9ybURhdGEuZ2V0KCdjaGVja291dCcpLnRvU3RyaW5nKCksXG4gICAgICBtYXhQcmljZTogK2Zvcm1EYXRhLmdldCgncHJpY2UnKVxuICAgIH1cbiAgLy8g0L/RgNC4INC+0YLQv9GA0LDQstC60LUg0YTQvtGA0LzRiyDQv9GA0L7QstC10YDRj9C10Lwg0LLRi9Cx0YDQsNC9INC70Lgg0L/RgNC+0LLRi9C50LTQtdGAXG4gIGlmICghY2hlY2tlZEl0ZW0ubGVuZ3RoKSB7IC8vINC10YHQu9C4INC90LXRgiwg0YLQviDQstGL0LHRgNCw0YLRjFxuICAgIGNvbnNvbGUubG9nKCdDaG9vc2UgcHJvdmlkZXIgYW5kIHN1Ym1pdCBhZ2Fpbi4nKTtcbiAgfSBlbHNlIHtcbiAgICBsZXQgaG9teUZvdW5kZWQ6IFBsYWNlcyA9IHt9O1xuICAgIGxldCBmbGF0UmVudEZvdW5kZWQ6IFBsYWNlcyA9e307XG4gICAgbGV0IGFsbEZvdW5kOiBQbGFjZXMgPSB7fTtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY2hlY2tlZEl0ZW0ubGVuZ3RoOyBpKyspIHtcbiAgICBpZiAoY2hlY2tlZEl0ZW1baV0udmFsdWUgPT09ICdob215Jykge1xuICAgICAgaG9teUZvdW5kZWQgPSBoYW5kbGVyU2VhcmNoKGRhdGFEYiwgZGF0YS5tYXhQcmljZSk7XG4gICAgICBhbGxGb3VuZCA9IE9iamVjdC5hc3NpZ24oaG9teUZvdW5kZWQpO1xuICAgICAgcmVuZGVyU2VhcmNoUmVzdWx0c0Jsb2NrKGFsbEZvdW5kKTtcbiAgICAgIHRvZ2dsZUZhdm9yaXRlSXRlbSgpO1xuICAgIH1cbiAgICBpZiAoY2hlY2tlZEl0ZW1baV0udmFsdWUgPT09ICdmbGF0LXJlbnQnKSB7XG5cbiAgICAgIGNvbnN0IG5ld0ZsYXQgPSBuZXcgRmxhdFJlbnRTZGs7XG4gICAgICBjb25zdCBmbGF0UmVudERhdGEgPSB7XG4gICAgICAgIGNpdHk6ICfQodCw0L3QutGCLdCf0LXRgtC10YDQsdGD0YDQsycsXG4gICAgICAgIGNoZWNrSW5EYXRlOiBuZXcgRGF0ZShmb3JtRGF0YS5nZXQoJ2NoZWNraW4nKS50b1N0cmluZygpKSxcbiAgICAgICAgY2hlY2tPdXREYXRlOiBuZXcgRGF0ZShmb3JtRGF0YS5nZXQoJ2NoZWNrb3V0JykudG9TdHJpbmcoKSksXG4gICAgICAgIHByaWNlTGltaXQ6ICtmb3JtRGF0YS5nZXQoJ3ByaWNlJylcbiAgICAgIH1cbiAgICAgIGNvbnN0IGZvdW5kRmxhdHMgPSBuZXdGbGF0LnNlYXJjaChmbGF0UmVudERhdGEpIFxuICAgICAgICAgXG4gICAgICBmb3VuZEZsYXRzLnRoZW4ocmVzID0+IHtcbiAgICAgICAgZmxhdFJlbnRGb3VuZGVkID0gT2JqZWN0LmFzc2lnbih7fSxyZXMpO1xuICAgICAgICAvL9C/0LXRgNC10LjQvNC10L3QvtCy0LDRgtGMINC60LvRjtGH0Lgg0LIg0L/QvtC70YPRh9C40LLRiNC10LzRgdGPINC+0LHRitC10LrRgtC1XG4gICAgICAgIGxldCByZW5hbWVkRmxhdFJlbnQgPSBPYmplY3QuZW50cmllcyhmbGF0UmVudEZvdW5kZWQpLnJlZHVjZSgodSwgW24sIHZdKSA9PiB7XG4gICAgICAgICAgdVtgJHtufUZSc2RrYF0gPSB2O1xuICAgICAgICAgIHJldHVybiB1O1xuICAgICAgICB9LCB7fSk7XG4gICAgICAgIC8v0YHQvtCx0YDQsNGC0Ywg0LTQstCwINC+0LHRitC10LrRgtCwINCyINC+0LTQuNC9XG4gICAgICAgIGFsbEZvdW5kID0gT2JqZWN0LmFzc2lnbihob215Rm91bmRlZCwgcmVuYW1lZEZsYXRSZW50KTtcbiAgICAgICAgLy/QstGL0LfQstCw0YLRjCDRgNC10L3QtNC10YAg0YEg0L7QsdGJ0LjQvCDQvtCx0YrQtdC60YLQvtC8XG4gICAgICAgIHJlbmRlclNlYXJjaFJlc3VsdHNCbG9jayhhbGxGb3VuZCk7XG4gICAgICAgIHRvZ2dsZUZhdm9yaXRlSXRlbSgpO1xuXG4gICAgICB9KVxuICAgIH1cbiAgfVxuICB9XG59XG59XG5cbmNvbnN0IGQgPSBuZXcgRGF0ZSgpO1xuY29uc3QgZGF0ZU91dCA9IG5ldyBEYXRlKGQuZ2V0RnVsbFllYXIoKSwgZC5nZXRNb250aCgpICsgMiwgMCk7XG5jb25zdCBkZWZhdWx0RGF0ZUluID0gbmV3IERhdGUoZC5zZXREYXRlKGQuZ2V0RGF0ZSgpICsgMSkpO1xuY29uc3QgZGVmYXVsdERhdGVPdXQgPSBuZXcgRGF0ZShkLnNldERhdGUoZC5nZXREYXRlKCkgKyAzKSk7XG5cbmZ1bmN0aW9uIGZvcm1hdHRlZERhdGUoZGF0ZSkge1xuICByZXR1cm4gW2RhdGUuZ2V0RnVsbFllYXIoKSwgZGF0ZS5nZXRNb250aCgpICsgMSwgZGF0ZS5nZXREYXRlKCldLm1hcChuID0+IG4gPCAxMCA/IGAwJHtufWAgOiBgJHtufWApLmpvaW4oJy0nKTtcbn1cblxuY29uc3QgdG9kYXkgPSBmb3JtYXR0ZWREYXRlKGQpO1xuY29uc3QgbWF4T3V0RGF0ZSA9IGZvcm1hdHRlZERhdGUoZGF0ZU91dCk7XG5jb25zdCBkZWZhdWx0SW4gPSBmb3JtYXR0ZWREYXRlKGRlZmF1bHREYXRlSW4pO1xuY29uc3QgZGVmYXVsdE91dCA9IGZvcm1hdHRlZERhdGUoZGVmYXVsdERhdGVPdXQpO1xuXG5leHBvcnQgZnVuY3Rpb24gcmVuZGVyU2VhcmNoRm9ybUJsb2NrIChkYXRlSW46IHN0cmluZyA9IGRlZmF1bHRJbiwgZGF0ZU91dDogc3RyaW5nID0gZGVmYXVsdE91dCkge1xuICByZW5kZXJCbG9jayhcbiAgICAnc2VhcmNoLWZvcm0tYmxvY2snLFxuICAgIGBcbiAgICA8Zm9ybSBpZD1cImZvcm1cIj5cbiAgICAgIDxmaWVsZHNldCBjbGFzcz1cInNlYXJjaC1maWxlZHNldFwiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwicm93XCI+XG4gICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgIDxsYWJlbCBmb3I9XCJjaXR5XCI+0JPQvtGA0L7QtDwvbGFiZWw+XG4gICAgICAgICAgICA8aW5wdXQgaWQ9XCJjaXR5XCIgdHlwZT1cInRleHRcIiBkaXNhYmxlZCB2YWx1ZT1cItCh0LDQvdC60YIt0J/QtdGC0LXRgNCx0YPRgNCzXCIgLz5cbiAgICAgICAgICAgIDxpbnB1dCB0eXBlPVwiaGlkZGVuXCIgZGlzYWJsZWQgdmFsdWU9XCI1OS45Mzg2LDMwLjMxNDFcIiAvPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJwcm92aWRlcnNcIj5cbiAgICAgICAgICAgIDxsYWJlbD48aW5wdXQgdHlwZT1cImNoZWNrYm94XCIgbmFtZT1cInByb3ZpZGVyXCIgY2xhc3M9XCJzZWxlY3RQcm92aWRlclwiIHZhbHVlPVwiaG9teVwiIGNoZWNrZWQgLz4gSG9teTwvbGFiZWw+XG4gICAgICAgICAgICA8bGFiZWw+PGlucHV0IHR5cGU9XCJjaGVja2JveFwiIG5hbWU9XCJwcm92aWRlclwiIGNsYXNzPVwic2VsZWN0UHJvdmlkZXJcIiB2YWx1ZT1cImZsYXQtcmVudFwiIC8+IEZsYXRSZW50PC9sYWJlbD5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJyb3dcIj5cbiAgICAgICAgICA8ZGl2PlxuICAgICAgICAgICAgPGxhYmVsIGZvcj1cImNoZWNrLWluLWRhdGVcIj7QlNCw0YLQsCDQt9Cw0LXQt9C00LA8L2xhYmVsPlxuICAgICAgICAgICAgPGlucHV0IGlkPVwiY2hlY2staW4tZGF0ZVwiIHR5cGU9XCJkYXRlXCIgdmFsdWU9XCIke2RhdGVJbn1cIiBtaW49XCIke3RvZGF5fVwiIG1heD1cIiR7bWF4T3V0RGF0ZX1cIiBuYW1lPVwiY2hlY2tpblwiIC8+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgIDxsYWJlbCBmb3I9XCJjaGVjay1vdXQtZGF0ZVwiPtCU0LDRgtCwINCy0YvQtdC30LTQsDwvbGFiZWw+XG4gICAgICAgICAgICA8aW5wdXQgaWQ9XCJjaGVjay1vdXQtZGF0ZVwiIHR5cGU9XCJkYXRlXCIgdmFsdWU9XCIke2RhdGVPdXR9XCIgbWluPVwiJHt0b2RheX1cIiBtYXg9XCIke21heE91dERhdGV9XCIgbmFtZT1cImNoZWNrb3V0XCIgLz5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8ZGl2PlxuICAgICAgICAgICAgPGxhYmVsIGZvcj1cIm1heC1wcmljZVwiPtCc0LDQutGBLiDRhtC10L3QsCDRgdGD0YLQvtC6PC9sYWJlbD5cbiAgICAgICAgICAgIDxpbnB1dCBpZD1cIm1heC1wcmljZVwiIHR5cGU9XCJ0ZXh0XCIgdmFsdWU9XCJcIiBuYW1lPVwicHJpY2VcIiBjbGFzcz1cIm1heC1wcmljZVwiIC8+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgIDxkaXY+PGJ1dHRvbiB0eXBlPVwic3VibWl0XCI+0J3QsNC50YLQuDwvYnV0dG9uPjwvZGl2PlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZmllbGRzZXQ+XG4gICAgPC9mb3JtPlxuICAgIGBcbiAgKVxufVxuIl19