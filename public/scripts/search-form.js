import { renderBlock } from './lib.js';
import { renderSearchResultsBlock, toggleFavoriteItem } from './search-results.js';
import { factory } from './store/domain/class-factory.js';
export function search() {
    const form = document.getElementsByTagName('form')[0];
    form.onsubmit = (e) => {
        e.preventDefault();
        let formData = new FormData(form);
        //получить чекбоксы
        const checkboxes = document.getElementsByClassName('selectProvider');
        const checkedProviders = [];
        //выбранные сложить в массив
        for (let i = 0; i < checkboxes.length; i++) {
            let item = checkboxes[i];
            if (item.checked) {
                checkedProviders.push(item.value);
            }
        }
        const data = {
            city: 'Санкт-Петербург',
            checkInDate: new Date(formData.get('checkin').toString()),
            checkOutDate: new Date(formData.get('checkout').toString()),
            priceLimit: +formData.get('price')
        };
        // при отправке формы проверяем выбран ли провыйдер
        if (!checkedProviders.length) { // если нет, то выбрать
            console.log('Choose provider and submit again.');
        }
        else {
            const providers = checkedProviders.map(name => factory(name));
            Promise.all(providers.map(provider => provider.search(data))).then((result) => {
                const allResults = [].concat(...result);
                renderSearchResultsBlock(allResults);
                toggleFavoriteItem();
            });
        }
    };
}
const d = new Date();
const dateOut = new Date(d.getFullYear(), d.getMonth() + 2, 0);
const defaultDateIn = new Date(d.setDate(d.getDate() + 1));
const defaultDateOut = new Date(d.setDate(d.getDate() + 3));
function formattedDate(date) {
    return [date.getFullYear(), date.getMonth() + 1, date.getDate()].map(n => n < 10 ? `0${n}` : `${n}`).join('-');
}
const today = formattedDate(d);
const maxOutDate = formattedDate(dateOut);
const defaultIn = formattedDate(defaultDateIn);
const defaultOut = formattedDate(defaultDateOut);
export function renderSearchFormBlock(dateIn = defaultIn, dateOut = defaultOut) {
    renderBlock('search-form-block', `
    <form id="form">
      <fieldset class="search-filedset">
        <div class="row">
          <div>
            <label for="city">Город</label>
            <input id="city" type="text" disabled value="Санкт-Петербург" />
            <input type="hidden" disabled value="59.9386,30.3141" />
          </div>
          <div class="providers">
            <label><input type="checkbox" name="provider" class="selectProvider" value="HomyProvider" checked /> Homy</label>
            <label><input type="checkbox" name="provider" class="selectProvider" value="FlatRentSdk" /> FlatRent</label>
          </div>
        </div>
        <div class="row">
          <div>
            <label for="check-in-date">Дата заезда</label>
            <input id="check-in-date" type="date" value="${dateIn}" min="${today}" max="${maxOutDate}" name="checkin" />
          </div>
          <div>
            <label for="check-out-date">Дата выезда</label>
            <input id="check-out-date" type="date" value="${dateOut}" min="${today}" max="${maxOutDate}" name="checkout" />
          </div>
          <div>
            <label for="max-price">Макс. цена суток</label>
            <input id="max-price" type="text" value="" name="price" class="max-price" />
          </div>
          <div>
            <div><button type="submit">Найти</button></div>
          </div>
        </div>
      </fieldset>
    </form>
    `);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VhcmNoLWZvcm0uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvc2VhcmNoLWZvcm0udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLFVBQVUsQ0FBQTtBQUN0QyxPQUFPLEVBQUUsd0JBQXdCLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQTtBQUdsRixPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0saUNBQWlDLENBQUE7QUFFekQsTUFBTSxVQUFVLE1BQU07SUFDcEIsTUFBTSxJQUFJLEdBQUcsUUFBUSxDQUFDLG9CQUFvQixDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBRXRELElBQUksQ0FBQyxRQUFRLEdBQUcsQ0FBQyxDQUFDLEVBQUUsRUFBRTtRQUNwQixDQUFDLENBQUMsY0FBYyxFQUFFLENBQUM7UUFDbkIsSUFBSSxRQUFRLEdBQUcsSUFBSSxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFbEMsbUJBQW1CO1FBQ25CLE1BQU0sVUFBVSxHQUFHLFFBQVEsQ0FBQyxzQkFBc0IsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBQ3JFLE1BQU0sZ0JBQWdCLEdBQUcsRUFBRSxDQUFDO1FBQzVCLDRCQUE0QjtRQUM1QixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsVUFBVSxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTtZQUMxQyxJQUFJLElBQUksR0FBRyxVQUFVLENBQUMsQ0FBQyxDQUFxQixDQUFBO1lBQzVDLElBQUksSUFBSSxDQUFDLE9BQU8sRUFBRTtnQkFDaEIsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQzthQUNuQztTQUNGO1FBRUQsTUFBTSxJQUFJLEdBQW1CO1lBQzNCLElBQUksRUFBRSxpQkFBaUI7WUFDdkIsV0FBVyxFQUFFLElBQUksSUFBSSxDQUFDLFFBQVEs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eyByZW5kZXJTZWFyY2hSZXN1bHRzQmxvY2ssIHRvZ2dsZUZhdm9yaXRlSXRlbSB9IGZyb20gJy4vc2VhcmNoLXJlc3VsdHMuanMnXG5pbXBvcnQgeyBQbGFjZSB9IGZyb20gJy4vc3RvcmUvZG9tYWluL3BsYWNlLmpzJ1xuaW1wb3J0IHsgU2VhcmNoRm9ybURhdGEgfSBmcm9tICcuL3N0b3JlL2RvbWFpbi9zZWFyY2gtZm9ybS1kYXRhLmpzJ1xuaW1wb3J0IHsgZmFjdG9yeSB9IGZyb20gJy4vc3RvcmUvZG9tYWluL2NsYXNzLWZhY3RvcnkuanMnXG5cbmV4cG9ydCBmdW5jdGlvbiBzZWFyY2goKSB7XG4gIGNvbnN0IGZvcm0gPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnZm9ybScpWzBdO1xuICBcbiAgZm9ybS5vbnN1Ym1pdCA9IChlKSA9PiB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGxldCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YShmb3JtKTtcblxuICAgIC8v0L/QvtC70YPRh9C40YLRjCDRh9C10LrQsdC+0LrRgdGLXG4gICAgY29uc3QgY2hlY2tib3hlcyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3NlbGVjdFByb3ZpZGVyJyk7XG4gICAgY29uc3QgY2hlY2tlZFByb3ZpZGVycyA9IFtdO1xuICAgIC8v0LLRi9Cx0YDQsNC90L3Ri9C1INGB0LvQvtC20LjRgtGMINCyINC80LDRgdGB0LjQslxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY2hlY2tib3hlcy5sZW5ndGg7IGkrKykge1xuICAgICAgbGV0IGl0ZW0gPSBjaGVja2JveGVzW2ldIGFzIEhUTUxJbnB1dEVsZW1lbnRcbiAgICAgIGlmIChpdGVtLmNoZWNrZWQpIHtcbiAgICAgICAgY2hlY2tlZFByb3ZpZGVycy5wdXNoKGl0ZW0udmFsdWUpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IGRhdGE6IFNlYXJjaEZvcm1EYXRhID0ge1xuICAgICAgY2l0eTogJ9Ch0LDQvdC60YIt0J/QtdGC0LXRgNCx0YPRgNCzJyxcbiAgICAgIGNoZWNrSW5EYXRlOiBuZXcgRGF0ZShmb3JtRGF0YS5nZXQoJ2NoZWNraW4nKS50b1N0cmluZygpKSxcbiAgICAgIGNoZWNrT3V0RGF0ZTogbmV3IERhdGUoZm9ybURhdGEuZ2V0KCdjaGVja291dCcpLnRvU3RyaW5nKCkpLFxuICAgICAgcHJpY2VMaW1pdDogK2Zvcm1EYXRhLmdldCgncHJpY2UnKVxuICAgIH1cbiAgLy8g0L/RgNC4INC+0YLQv9GA0LDQstC60LUg0YTQvtGA0LzRiyDQv9GA0L7QstC10YDRj9C10Lwg0LLRi9Cx0YDQsNC9INC70Lgg0L/RgNC+0LLRi9C50LTQtdGAXG4gIGlmICghY2hlY2tlZFByb3ZpZGVycy5sZW5ndGgpIHsgLy8g0LXRgdC70Lgg0L3QtdGCLCDRgtC+INCy0YvQsdGA0LDRgtGMXG4gICAgY29uc29sZS5sb2coJ0Nob29zZSBwcm92aWRlciBhbmQgc3VibWl0IGFnYWluLicpO1xuICB9IGVsc2Uge1xuXG4gICAgY29uc3QgcHJvdmlkZXJzID0gY2hlY2tlZFByb3ZpZGVycy5tYXAobmFtZSA9PiBmYWN0b3J5KG5hbWUpKTtcblxuICAgICAgUHJvbWlzZS5hbGwoXG4gICAgICAgIHByb3ZpZGVycy5tYXAocHJvdmlkZXIgPT4gcHJvdmlkZXIuc2VhcmNoKGRhdGEpKVxuICAgICAgKS50aGVuKChyZXN1bHQpID0+IHtcblxuICAgICAgY29uc3QgYWxsUmVzdWx0czogUGxhY2VbXSA9IFtdLmNvbmNhdCguLi5yZXN1bHQpXG4gICAgICByZW5kZXJTZWFyY2hSZXN1bHRzQmxvY2soYWxsUmVzdWx0cyk7XG4gICAgICB0b2dnbGVGYXZvcml0ZUl0ZW0oKTtcbiAgICB9KVxuICB9XG59XG59XG5cbmNvbnN0IGQgPSBuZXcgRGF0ZSgpO1xuY29uc3QgZGF0ZU91dCA9IG5ldyBEYXRlKGQuZ2V0RnVsbFllYXIoKSwgZC5nZXRNb250aCgpICsgMiwgMCk7XG5jb25zdCBkZWZhdWx0RGF0ZUluID0gbmV3IERhdGUoZC5zZXREYXRlKGQuZ2V0RGF0ZSgpICsgMSkpO1xuY29uc3QgZGVmYXVsdERhdGVPdXQgPSBuZXcgRGF0ZShkLnNldERhdGUoZC5nZXREYXRlKCkgKyAzKSk7XG5cbmZ1bmN0aW9uIGZvcm1hdHRlZERhdGUoZGF0ZSkge1xuICByZXR1cm4gW2RhdGUuZ2V0RnVsbFllYXIoKSwgZGF0ZS5nZXRNb250aCgpICsgMSwgZGF0ZS5nZXREYXRlKCldLm1hcChuID0+IG4gPCAxMCA/IGAwJHtufWAgOiBgJHtufWApLmpvaW4oJy0nKTtcbn1cblxuY29uc3QgdG9kYXkgPSBmb3JtYXR0ZWREYXRlKGQpO1xuY29uc3QgbWF4T3V0RGF0ZSA9IGZvcm1hdHRlZERhdGUoZGF0ZU91dCk7XG5jb25zdCBkZWZhdWx0SW4gPSBmb3JtYXR0ZWREYXRlKGRlZmF1bHREYXRlSW4pO1xuY29uc3QgZGVmYXVsdE91dCA9IGZvcm1hdHRlZERhdGUoZGVmYXVsdERhdGVPdXQpO1xuXG5leHBvcnQgZnVuY3Rpb24gcmVuZGVyU2VhcmNoRm9ybUJsb2NrIChkYXRlSW46IHN0cmluZyA9IGRlZmF1bHRJbiwgZGF0ZU91dDogc3RyaW5nID0gZGVmYXVsdE91dCkge1xuICByZW5kZXJCbG9jayhcbiAgICAnc2VhcmNoLWZvcm0tYmxvY2snLFxuICAgIGBcbiAgICA8Zm9ybSBpZD1cImZvcm1cIj5cbiAgICAgIDxmaWVsZHNldCBjbGFzcz1cInNlYXJjaC1maWxlZHNldFwiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwicm93XCI+XG4gICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgIDxsYWJlbCBmb3I9XCJjaXR5XCI+0JPQvtGA0L7QtDwvbGFiZWw+XG4gICAgICAgICAgICA8aW5wdXQgaWQ9XCJjaXR5XCIgdHlwZT1cInRleHRcIiBkaXNhYmxlZCB2YWx1ZT1cItCh0LDQvdC60YIt0J/QtdGC0LXRgNCx0YPRgNCzXCIgLz5cbiAgICAgICAgICAgIDxpbnB1dCB0eXBlPVwiaGlkZGVuXCIgZGlzYWJsZWQgdmFsdWU9XCI1OS45Mzg2LDMwLjMxNDFcIiAvPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJwcm92aWRlcnNcIj5cbiAgICAgICAgICAgIDxsYWJlbD48aW5wdXQgdHlwZT1cImNoZWNrYm94XCIgbmFtZT1cInByb3ZpZGVyXCIgY2xhc3M9XCJzZWxlY3RQcm92aWRlclwiIHZhbHVlPVwiSG9teVByb3ZpZGVyXCIgY2hlY2tlZCAvPiBIb215PC9sYWJlbD5cbiAgICAgICAgICAgIDxsYWJlbD48aW5wdXQgdHlwZT1cImNoZWNrYm94XCIgbmFtZT1cInByb3ZpZGVyXCIgY2xhc3M9XCJzZWxlY3RQcm92aWRlclwiIHZhbHVlPVwiRmxhdFJlbnRTZGtcIiAvPiBGbGF0UmVudDwvbGFiZWw+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwicm93XCI+XG4gICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgIDxsYWJlbCBmb3I9XCJjaGVjay1pbi1kYXRlXCI+0JTQsNGC0LAg0LfQsNC10LfQtNCwPC9sYWJlbD5cbiAgICAgICAgICAgIDxpbnB1dCBpZD1cImNoZWNrLWluLWRhdGVcIiB0eXBlPVwiZGF0ZVwiIHZhbHVlPVwiJHtkYXRlSW59XCIgbWluPVwiJHt0b2RheX1cIiBtYXg9XCIke21heE91dERhdGV9XCIgbmFtZT1cImNoZWNraW5cIiAvPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDxkaXY+XG4gICAgICAgICAgICA8bGFiZWwgZm9yPVwiY2hlY2stb3V0LWRhdGVcIj7QlNCw0YLQsCDQstGL0LXQt9C00LA8L2xhYmVsPlxuICAgICAgICAgICAgPGlucHV0IGlkPVwiY2hlY2stb3V0LWRhdGVcIiB0eXBlPVwiZGF0ZVwiIHZhbHVlPVwiJHtkYXRlT3V0fVwiIG1pbj1cIiR7dG9kYXl9XCIgbWF4PVwiJHttYXhPdXREYXRlfVwiIG5hbWU9XCJjaGVja291dFwiIC8+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgIDxsYWJlbCBmb3I9XCJtYXgtcHJpY2VcIj7QnNCw0LrRgS4g0YbQtdC90LAg0YHRg9GC0L7QujwvbGFiZWw+XG4gICAgICAgICAgICA8aW5wdXQgaWQ9XCJtYXgtcHJpY2VcIiB0eXBlPVwidGV4dFwiIHZhbHVlPVwiXCIgbmFtZT1cInByaWNlXCIgY2xhc3M9XCJtYXgtcHJpY2VcIiAvPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDxkaXY+XG4gICAgICAgICAgICA8ZGl2PjxidXR0b24gdHlwZT1cInN1Ym1pdFwiPtCd0LDQudGC0Lg8L2J1dHRvbj48L2Rpdj5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2ZpZWxkc2V0PlxuICAgIDwvZm9ybT5cbiAgICBgXG4gIClcbn0iXX0=